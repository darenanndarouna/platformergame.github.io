<!doctype html><html lang="ja"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="description" content="2人対戦のプラットフォームゲームです。GitHub Pagesで公開中。"/><link rel="icon" type="image/png" href="favicon.png"><title>対戦型プラットフォーマー</title><style>*{box-sizing:border-box}body{margin:0;overflow:hidden;height:100vh;background:linear-gradient(#9ed6ff,#bfe9ff)}.sun{position:absolute;right:6vh;top:4vh;width:140px;height:140px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff59d,#ffd27a 40%,#ffc34d 60%,#ffb347 100%);filter:blur(4px)}.g{position:absolute;left:0;right:0;bottom:0;height:20vh;background:linear-gradient(to top,#84331F 70%,#3ea34a 30%);box-shadow:0 -6px 20px rgba(0,0,0,.15) inset}.c{position:absolute;width:40px;height:40px;will-change:transform;pointer-events:none}.i{width:100%;height:100%;display:flex;align-items:center;justify-content:center;transition:transform .08s linear}.b{width:100%;height:100%;background:#000;border-radius:10px;transform-origin:center bottom;transition:transform .12s ease,border-radius .12s;box-shadow:0 6px 12px rgba(0,0,0,.25)}.c.walking .b{animation:walk .36s linear infinite;border-radius:9px}@keyframes walk{0%{transform:translateY(0) scaleY(1)}50%{transform:translateY(-6px) scaleY(.95)}100%{transform:translateY(0) scaleY(1)}}.c.jumping .b{animation:none;transform:translateY(0) scaleY(1.12);border-radius:8px}.c.land .b{animation:land .18s ease forwards}@keyframes land{0%{transform:translateY(0) scaleY(1.08)}50%{transform:translateY(0) scaleY(.82)}100%{transform:translateY(0) scaleY(1)}}.i.left{transform:scaleX(-1)}.s{position:absolute;left:50%;bottom:-6px;width:24px;height:6px;margin-left:-12px;background:rgba(0,0,0,.25);border-radius:50%;filter:blur(4px);transition:transform .12s,opacity .12s}.c.jumping .s{transform:scale(.6);opacity:.6}.c.land .s{transform:scale(1.05);opacity:.9}.label{position:fixed;transform:translateX(-50%);font-size:12px;font-weight:700;pointer-events:none;z-index:5}.hp{position:fixed;top:10px;left:10px;width:160px;height:18px;background:rgba(0,0,0,.15);border-radius:10px;overflow:hidden}.hp .in{height:100%;background:rgba(255,100,100,.9);width:100%}.hp.r{left:auto;right:10px}.hp.r .in{background:rgba(100,140,255,.95)}.bullet{position:absolute;width:14px;height:14px;border-radius:50%;background:#ff4b4b;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff}.btxt{position:absolute;top:-14px;font-size:10px;font-weight:700;pointer-events:none}.ov{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center;color:#fff;font-size:24px;z-index:999;display:none}.c.guarding .b{box-shadow:0 6px 22px rgba(0,120,255,.35), inset 0 0 10px rgba(120,180,255,.12); background:linear-gradient(#a9d7ff,#74bfff); border-radius:12px; transform:scale(0.98)}.shield{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:60px;height:60px;border-radius:50%;pointer-events:none;opacity:0;transition:opacity .12s;z-index:-1}.c.guarding .shield{opacity:.9}.shield::after{content:'';position:absolute;left:0;top:0;right:0;bottom:0;border-radius:50%;box-shadow:0 0 18px rgba(100,170,255,.8) inset, 0 0 30px rgba(100,170,255,.2)}.item{position:absolute;width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;pointer-events:none;box-shadow:0 6px 12px rgba(0,0,0,.2)}.item.heal{background:linear-gradient(#ff9a9a,#ff5d5d)}.item.buff{background:linear-gradient(#ffd57a,#ffb347)}.item .tag{position:absolute;top:-20px;left:50%;transform:translateX(-50%);font-size:10px;font-weight:700;pointer-events:none}</style></head><body><div class="sun"></div><div class="g" id="g"></div><div class="c" id="p1"><div class="i" id="i1"><div class="b"></div></div><div class="s"></div><div class="shield"></div></div><div class="c" id="p2"><div class="i" id="i2"><div class="b"></div></div><div class="s"></div><div class="shield"></div></div><div class="label" id="l1" style="color:rgba(160,90,90,.9)">1P</div><div class="label" id="l2" style="color:rgba(90,120,160,.95)">2P</div><div class="hp" id="h1"><div class="in" id="hi1"></div></div><div class="hp r" id="h2"><div class="in" id="hi2"></div></div><div class="ov" id="ov"></div><script>const g=document.getElementById('g'),p1=document.getElementById('p1'),p2=document.getElementById('p2'),i1=document.getElementById('i1'),i2=document.getElementById('i2'),l1=document.getElementById('l1'),l2=document.getElementById('l2'),hi1=document.getElementById('hi1'),hi2=document.getElementById('hi2'),ov=document.getElementById('ov');const W=40,H=40,S=6,G=1,J=-18,BS=9;let sw=innerWidth,sh=innerHeight,k={};addEventListener('resize',()=>{sw=innerWidth;sh=innerHeight});addEventListener('keydown',e=>{k[e.key]=1});addEventListener('keyup',e=>{k[e.key]=0});let R=Math.max(1,parseInt(prompt('何本勝負にしますか？','3'))||3);let p=[{x:20,y:0,vx:0,vy:0,last:1,on:1,hp:100,guardActive:false,guardCooldown:0,alive:1,w:0,el:p1,ie:i1,l:l1,_lastShot:0,attackBase:20,attackMul:1,buffUntil:0},{x:sw-W-20,y:0,vx:0,vy:0,last:-1,on:1,hp:100,guardActive:false,guardCooldown:0,alive:1,w:0,el:p2,ie:i2,l:l2,_lastShot:0,attackBase:20,attackMul:1,buffUntil:0}];function gy(){return g.getBoundingClientRect().top}p[0].y=p[1].y=gy()-H;let B=[];function mk(x,y,v,o){let e=document.createElement('div'),t=document.createElement('div');e.className='bullet';t.className='btxt';t.textContent=o==0?'1P':'2P';e.appendChild(t);document.body.appendChild(e);B.push({e,x,y,v,o,t})}function resp(i){p[i].alive=0;setTimeout(()=>{p[i].x=Math.random()*(sw-W);p[i].y=gy()-H;p[i].hp=100;p[i].alive=1},800)}function hit(b,pl){if(!pl.alive||pl.guardActive||pl===p[b.o])return false;let bx=b.x,by=b.y,px=pl.x,py=pl.y;if(bx+14>px&&bx<px+W&&by+14>py&&by<py+H){pl.hp-=Math.round(p[b.o].attackBase*p[b.o].attackMul/20*20);pl.x+=(b.v>0?6:-6);pl.vy=-8;return true}return false}let items=[],lastItemAttempt=performance.now(),ITEM_CHECK_INTERVAL=5000;function spawnItemIfNeeded(){const now=performance.now();if(now-lastItemAttempt<ITEM_CHECK_INTERVAL)return;lastItemAttempt=now;if(items.length>0)return;if(Math.random()<1/3){const type=Math.random()<0.5?'heal':'buff',x=Math.max(10,Math.random()*(sw-60)),y=-40,e=document.createElement('div');e.className='item '+type;e.innerHTML=type==='heal'?'❤':'⚡';const tag=document.createElement('div');tag.className='tag';tag.textContent=type==='heal'?'HP回復':'攻撃UP';e.appendChild(tag);document.body.appendChild(e);const it={e,type,x,y,vy:0,landed:false,landTime:0,removeTimeout:null};items.push(it)}}function removeItem(idx){const it=items[idx];if(!it)return;if(it.removeTimeout)clearTimeout(it.removeTimeout);try{it.e.remove()}catch(e){}items.splice(idx,1)}function applyItemToPlayer(it,player){if(it.type==='heal'){player.hp=100}else if(it.type==='buff'){player.attackMul=1.5;player.buffUntil=performance.now()+5000}}function upd(){const now=performance.now();let ground=gy()-H;spawnItemIfNeeded();for(let i=0;i<2;i++){let u=p[i],left=i==0?(k['a']||0):(k['ArrowLeft']||0),right=i==0?(k['d']||0):(k['ArrowRight']||0),up=i==0?(k['w']||0):(k['ArrowUp']||0);if(right&&!left){u.x+=S;u.last=1}else if(left&&!right){u.x-=S;u.last=-1}if(up&&Math.abs(u.y-ground)<.5)u.vy=J;u.vy+=G;u.y+=u.vy;if(u.y>ground){u.y=ground;u.vy=0;u.on=1}else u.on=0;if(u.x<0)u.x=0;if(u.x+W>sw)u.x=sw-W;u.el.style.transform='translate('+u.x+'px,'+u.y+'px)';u.ie.classList.toggle('left',u.last<0);u.el.classList.toggle('walking',(left||right)&&u.on);u.el.classList.toggle('jumping',!u.on);if(!u.on){u.el.classList.add('land');clearTimeout(u._t);u._t=setTimeout(()=>u.el.classList.remove('land'),200)}u.l.style.left=(u.x+W/2)+'px';u.l.style.bottom=(sh-u.y+6)+'px';const guardKey=i==0?'g':'.';const pressingGuard=!!k[guardKey];if(pressingGuard&&!u.guardActive&&now>=u.guardCooldown){u.guardActive=true;u.guardHoldStart=now}if(!pressingGuard&&u.guardActive){u.guardActive=false;u.guardCooldown=now+5000}if(u.guardActive&&(now-(u.guardHoldStart||now))>=3000){u.guardActive=false;u.guardCooldown=now+5000}if(now<u.guardCooldown){u.el.classList.remove('guarding')}else{u.el.classList.toggle('guarding',u.guardActive)}const fireKey=i==0?'f':',';if(k[fireKey]&&u.alive){if(!u._shotHeld){u._shotHeld=true;const canShoot=now-(u._lastShot||0)>=500&&!u.guardActive;if(canShoot){u._lastShot=now;mk(u.x+W/2-7,u.y+H/2-7,BS*u.last,i)}}}else{u._shotHeld=false}if(u.buffUntil&&now>=u.buffUntil){u.attackMul=1;u.buffUntil=0}}for(let i=B.length-1;i>=0;i--){let bb=B[i];bb.x+=bb.v;bb.e.style.transform='translate('+bb.x+'px,'+bb.y+'px)';if(bb.x<-30||bb.x>sw+30){bb.e.remove();B.splice(i,1);continue}let targ=p[1-bb.o];if(hit(bb,targ)){bb.e.remove();B.splice(i,1);if(targ.hp<=0){p[bb.o].w++;if(p[bb.o].w>=R){ov.style.display='flex';ov.textContent=(bb.o==0?'1P':'2P')+'の勝ち';return}resp(1-bb.o)}}else{bb.t.style.left='50%'}}hi1.style.width=Math.max(0,p[0].hp)+'%';hi2.style.width=Math.max(0,p[1].hp)+'%';for(let i=items.length-1;i>=0;i--){let it=items[i];if(!it.landed){it.vy+=0.6;it.y+=it.vy;if(it.y>=gy()-28){it.y=gy()-28;it.vy=0;it.landed=true;it.landTime=performance.now();it.removeTimeout=setTimeout(()=>{removeItem(items.indexOf(it))},5000)}it.e.style.transform='translate('+it.x+'px,'+it.y+'px)'}else{it.e.style.transform='translate('+it.x+'px,'+it.y+'px)';for(let j=0;j<2;j++){let pl=p[j];if(!pl.alive)continue;if(it.x+28>pl.x&&it.x<pl.x+W&&it.y+28>pl.y&&it.y<pl.y+H){applyItemToPlayer(it,pl);removeItem(i);break}}}}requestAnimationFrame(upd)}upd();</script></body></html>
